!function(){function e(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3,a=n.register;a("2q8vl",(function(t,n){e(t.exports,"LOADING_MODULE_DELAY",(function(){return a}));const a=300})),a("jOyQ7",(function(a,o){e(a.exports,"default",(function(){return r}));var r,i=n("fPPqr"),l=n("9nHZC"),s=n("lIZwG"),c=n("agjvf"),u=n("EKmRU"),d=n("dEKDm"),p=n("1gNsY"),m=n("c7ndm");(r=class extends l.PureComponent{constructor(...e){super(...e),this.timeout=void 0,this.state={delay:this.props.delay}}componentDidMount(){const{delay:e}=this.state;e&&(this.timeout=setTimeout((()=>this.setState({delay:0})),e))}componentWillUnmount(){clearTimeout(this.timeout)}render(){const{delay:e}=this.state,{action:n,module:a,failedCallback:o}=this.props;if("loading"===n&&e)return!1;const r=(0,s.default)(a,"app_name",(0,s.default)(a,"app_key","")),f=(0,s.default)(a,"app_base_url",(0,s.default)(a,"source.url",""));return t(l).createElement(m.Container,null,"loading"===n&&t(l).createElement(m.Spinner,null,t(l).createElement(d.default,{size:"small",delay:0})),r&&f&&t(l).createElement(c.FormattedMessage,t(i)({},p.default[n],{values:{link:t(l).createElement("a",{href:f,target:"_blank"},r),action:"timeout"===n&&t(l).createElement(u.default,{appearance:"link",spacing:"none",onClick:o},t(l).createElement(c.FormattedMessage,p.default.cancelText))}})))}}).defaultProps={action:"loading",delay:0}})),a("1gNsY",(function(t,a){e(t.exports,"default",(function(){return o}));var o=(0,n("agjvf").defineMessages)({loading:{id:"frontbucket.connect.loadingDescription",defaultMessage:"Loading app {link}."},timeout:{id:"frontbucket.connect.loadingTimeoutDescription",defaultMessage:"App {link} is not responding. Wait or {action}."},failed:{id:"frontbucket.connect.loadingFailedDescription",defaultMessage:"App {link} failed to load."},cancelText:{id:"frontbucket.connect.cancelText",defaultMessage:"cancel"}})})),a("c7ndm",(function(t,a){e(t.exports,"Container",(function(){return r})),e(t.exports,"Spinner",(function(){return i}));var o=n("2xJU3");const r=(0,o.default)("small",{target:"e1rsklf90"})({name:"1tbblij",styles:"position:absolute;left:0;top:0;right:0;bottom:0;display:flex;align-items:center;margin:0;padding:0 12px;"}),i=(0,o.default)("div",{target:"e1rsklf91"})({name:"ttjnck",styles:"margin:0 8px 0 0;"})})),a("9kkxk",(function(t,a){e(t.exports,"webPanelHeight",(function(){return l})),e(t.exports,"webPanelWidth",(function(){return s})),e(t.exports,"SourceWebPanel",(function(){return c})),e(t.exports,"PullRequestWebPanel",(function(){return u})),e(t.exports,"WebPanelHeader",(function(){return d})),e(t.exports,"WebPanelSection",(function(){return p}));var o=n("2xJU3"),r=n("aP6k3"),i=n("dCDrX");const l="50px",s="100%",c=(0,o.default)("div",{target:"evqr4d40"})("display:flex;position:relative;margin-bottom:",3*(0,r.gridSize)(),"px;min-height:",l,";max-height:280px;overflow:auto;iframe{display:block;}"),u=(0,o.default)("div",{target:"evqr4d41"})("display:flex;position:relative;margin-top:",(0,r.gridSize)(),"px;overflow:auto;min-height:",l,";max-height:600px;iframe{display:block;overflow:auto;}"),d=(0,o.default)("span",{target:"evqr4d42"})(i.h400(),";"),p=(0,o.default)("section",{target:"evqr4d43"})("margin-top:",(0,r.gridSize)(),"px;margin-bottom:",(0,r.gridSize)(),"px;")})),a("3F5vi",(function(t,a){e(t.exports,"ConnectSourceWebCards",(function(){return n("j1fGH").default})),e(t.exports,"ConnectPullRequestWebCards",(function(){return n("4dfKK").default}));n("j1fGH"),n("4dfKK")})),a("j1fGH",(function(a,o){e(a.exports,"default",(function(){return p}));var r=n("9nHZC"),i=n("lIZwG"),l=n("dGzLf"),s=n("bVIhs"),c=n("aanBq"),u=n("g2R3c"),d=n("ezxW3");var p=(0,l.connect)((e=>({principalId:(0,u.getTargetUserKey)(e),repository:(0,c.getCurrentRepository)(e),hash:(0,i.default)(e,"repository.source.section.hash"),sourceObject:e.repository.source.section.sourceObject})))((e=>{const{principalId:n,repository:a,hash:o,sourceObject:i,isCollapsed:l}=e;if(!n||!a||!i||i.isLoading)return null;const[c,u]=a.full_name.split("/"),{path:p,treeEntry:m}=i;return""===p?t(r).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source",isCollapsed:l,target:(0,s.repositoryTarget)({repositoryOwner:c,repositorySlug:u})}):p&&o&&m?"directory"===m.type?t(r).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source.directory",isCollapsed:l,target:(0,s.commitDirectoryTarget)({repositoryOwner:c,repositorySlug:u,path:`${p}/`,hash:o})}):t(r).createElement(d.WebCards,{principalId:n,location:"org.bitbucket.source.file",isCollapsed:l,target:(0,s.commitFileTarget)({repositoryOwner:c,repositorySlug:u,path:p,hash:o})}):null}))})),a("ezxW3",(function(a,o){e(a.exports,"WebCards",(function(){return f}));var r=n("fPPqr"),i=n("9nHZC"),l=n("lIZwG"),s=n("a7iuM"),c=n("6x4M3"),u=n("aUuqL"),d=n("dRi2h"),p=n("ks5r8"),m=n("4VBFd");class f extends i.PureComponent{render(){const{principalId:e,target:n,location:a,isCollapsed:o}=this.props;return t(i).createElement(c.ConnectIframes,{moduleType:"webCards",principalId:e,target:n,location:a,width:"100%",loadingComponent:()=>null,loadingFailedComponent:()=>null},(e=>e.length>0&&e.map((({Component:e,module:n})=>{const a=(0,l.default)(n,"descriptor.name.value"),c=t(i).createElement(d.default,{url:(0,l.default)(n,"descriptor.icon.url"),className:(0,l.default)(n,"descriptor.params.auiIcon")});return o?t(i).createElement(s.default,{key:n.id,position:"left",content:a},c):t(i).createElement(m.Card,{key:n.id,"data-qa":"connect-webcard"},t(i).createElement(u.ConnectedExpander,{defaultIsCollapsed:!0,localStorageKey:`${n.id}.card.collapsed`,icon:c,isLoading:!1,label:a,sectionAriaLabel:a},t(i).createElement(e,{loadingComponent:()=>t(i).createElement(p.default,{module:n,delay:300}),loadingTimeoutComponent:e=>t(i).createElement(p.default,t(r)({action:"timeout"},e,{module:n})),loadingFailedComponent:()=>t(i).createElement(p.default,{action:"failed",module:n})})))}))))}}})),a("dRi2h",(function(a,o){e(a.exports,"default",(function(){return c}));var r=n("2xJU3"),i=n("9nHZC");const l=(0,r.default)("span",{target:"e408k2m0"})({name:"96j35y",styles:"height:24px;width:24px;&::before{font-size:20px;margin-left:2px;margin-top:-10px;}"});class s extends i.PureComponent{render(){const{className:e,url:n}=this.props;if(n)return t(i).createElement("img",{src:n,alt:"",width:"24",height:"24"});const a=["aui-icon","aui-icon-large",e].join(" ").trim();return t(i).createElement(l,{className:a})}}var c=s})),a("ks5r8",(function(a,o){e(a.exports,"default",(function(){return r}));var r,i=n("fPPqr"),l=n("9nHZC"),s=n("lIZwG"),c=n("agjvf"),u=n("EKmRU"),d=n("dEKDm"),p=n("1gNsY"),m=n("dzmfC");(r=class extends l.PureComponent{constructor(...e){super(...e),this.timeout=void 0,this.state={delay:this.props.delay}}componentDidMount(){const{delay:e}=this.state;e&&(this.timeout=setTimeout((()=>this.setState({delay:0})),e))}componentWillUnmount(){clearTimeout(this.timeout)}render(){const{delay:e}=this.state,{action:n,module:a,failedCallback:o}=this.props;if("loading"===n&&e)return!1;const r=(0,s.default)(a,"app_name",(0,s.default)(a,"app_key","")),f=(0,s.default)(a,"app_base_url",(0,s.default)(a,"source.url",""));return t(l).createElement(m.Container,null,"loading"===n?t(l).createElement(m.Spinner,null,t(l).createElement(d.default,{size:"medium",delay:0})):r&&f&&t(l).createElement(c.FormattedMessage,t(i)({},p.default[n],{values:{link:t(l).createElement("a",{href:f,target:"_blank"},r),action:"timeout"===n&&t(l).createElement(u.default,{appearance:"link",spacing:"none",onClick:o},t(l).createElement(c.FormattedMessage,p.default.cancelText))}})))}}).defaultProps={action:"loading",delay:0}})),a("dzmfC",(function(t,a){e(t.exports,"Container",(function(){return i})),e(t.exports,"Spinner",(function(){return l}));var o=n("2xJU3"),r=n("aP6k3");const i=(0,o.default)("small",{target:"ey323gi0"})({name:"rmxqah",styles:"display:flex;justify-content:center;align-items:center;margin:0;"}),l=(0,o.default)("div",{target:"ey323gi1"})("margin:",(0,r.gridSize)(),"px 0;")})),a("4VBFd",(function(t,a){e(t.exports,"Card",(function(){return i}));var o=n("2xJU3"),r=n("aP6k3");const i=(0,o.default)("div",{target:"ejd26n00"})("& + &{margin-top:",1.5*(0,r.gridSize)(),"px;}")})),a("4dfKK",(function(a,o){e(a.exports,"default",(function(){return d}));var r=n("9nHZC"),i=n("dGzLf"),l=n("1EkdU"),s=n("g2R3c"),c=n("ezxW3");class u extends r.PureComponent{render(){const{principalId:e,target:n,isCollapsed:a}=this.props;return e&&n?t(r).createElement(c.WebCards,{principalId:e,target:n,isCollapsed:a,location:"org.bitbucket.pullrequest"}):null}}var d=(0,i.connect)((e=>({principalId:(0,s.getTargetUserKey)(e),target:(0,l.getCurrentPullRequest)(e)})))(u)})),a("lum6u",(function(a,o){e(a.exports,"default",(function(){return p}));var r=n("9nHZC"),i=n("8zVyv"),l=n("hw8PW"),s=n("c5NwI"),c=n("7nLM4"),u=n("dYHhS");const d=({isPrPage:e})=>{const{component:n,createLink:a,isLoading:o}=(0,u.useCompassDetails)();if(o)return null;const l=t(r).createElement(i.CompassIcon,{label:"Compass"});if(!n)return a&&!e?t(r).createElement(c.Expander,{icon:l,label:"Compass"},t(r).createElement(s.Row,null,t(r).createElement("p",null,"To unlock a view of recent activity, scorecards, metrics and more, consider"," ",t(r).createElement("a",{href:a,target:"_blank"},"linking this repository to Compass.")))):null;const d=e?[]:n.links.filter((e=>"CHAT_CHANNEL"===e.type)),p=e?["ari:cloud:compass::metric-definition/builtin/pull-request-cycle-time-avg-last-10"]:[],m=n.metrics.filter((e=>p.includes(e.id))),f=e?null:n.team;return t(r).createElement(c.Expander,{icon:l,label:"Compass"},t(r).createElement(s.Row,null,t(r).createElement(s.Field,{label:"Component name",value:t(r).createElement("a",{href:n.url,target:"_blank"},n.name)})),f&&t(r).createElement(s.Row,null,t(r).createElement(s.Field,{label:"Owner",value:t(r).createElement("a",{href:f.url,target:"_blank"},f.name)})),d.length?t(r).createElement(s.Row,null,t(r).createElement(s.Field,{label:"Chat channels",value:d.map((e=>t(r).createElement("a",{key:e.id,href:e.url,target:"_blank"},e.name)))})):null,m.map((e=>e.value?t(r).createElement(s.Row,{key:e.name},t(r).createElement(s.Field,{label:e.name,value:e.value})):null)))};var p=e=>(0,l.useFeature)(l.FeatureKeys.showCompassCard,!1)?t(r).createElement(d,e):null})),a("8zVyv",(function(a,o){e(a.exports,"CompassIcon",(function(){return d}));var r=n("9nHZC"),i=n("4ul5V"),l=n("gb0Xp"),s=n("EMAbO"),c=n("k5A1i"),u=function(e){var t=e.appearance,n=e.iconGradientStart,a=e.iconGradientStop,o={iconGradientStart:n,iconGradientStop:a,iconColor:e.iconColor},r=(0,i.uid)({iconGradientStart:a});return t&&(o=(0,s.getColorsFromAppearance)(t)),'\n  <svg\n  fill="none"\n  height="32"\n  viewBox="0 0 32 32"\n  xmlns="http://www.w3.org/2000/svg"\n  focusable="false"\n  aria-hidden="true"\n>\n  <linearGradient\n    id="'.concat(r,'"\n    gradientUnits="userSpaceOnUse"\n    x1="20.8536"\n    x2="11.8744"\n    y1="11.2763"\n    y2="20.2556"\n  >\n    <stop offset="20%" stop-color="').concat(o.iconGradientStart,'" ').concat("inherit"===o.iconGradientStart?'stop-opacity="0.4"':"",' />\n    <stop offset="100%" stop-color="').concat(o.iconGradientStop,'" />\n  </linearGradient>\n  <path\n    d="m16.4644 15.6278v5.309h-5.2337v-5.309h5.2337v-5.3059h-9.54745c-.12228.0008-.24319.0259-.3557.0738-.1125.048-.21436.1178-.29966.2054-.08529.0876-.15233.1914-.1972.3051-.04487.1138-.0667.2353-.0642.3576v14.0653c-.0025.1223.01933.2438.0642.3576.04487.1137.11191.2175.1972.3051.0853.0876.18716.1574.29966.2054.11251.0479.23342.073.3557.0738h13.85185c.1223-.0008.2432-.0259.3557-.0738.1125-.048.2144-.1178.2997-.2054s.1523-.1914.1972-.3051c.0449-.1138.0667-.2353.0642-.3576v-9.7013z"\n    fill="url(#').concat(r,')"\n  />\n  <path\n    d="m16.4636 5.01256v5.30904h5.2463v5.3059h5.218v-9.68562c.0025-.12227-.0194-.24381-.0642-.35757-.0449-.11376-.1119-.21747-.1972-.3051s-.1872-.15744-.2997-.20537c-.1125-.04794-.2334-.07303-.3557-.07384z"\n    fill="').concat(o.iconGradientStop,'"\n  />\n</svg>')},d=function(e){var n=e.appearance,a=e.label,o=void 0===a?"Compass":a,i=e.size,s=void 0===i?l.defaultLogoParams.size:i,d=e.testId,p=e.iconColor,m=void 0===p?l.defaultLogoParams.iconColor:p,f=e.iconGradientStart,g=void 0===f?l.defaultLogoParams.iconGradientStart:f,h=e.iconGradientStop,y=void 0===h?l.defaultLogoParams.iconGradientStop:h,C=e.textColor,v=void 0===C?l.defaultLogoParams.textColor:C;return t(r).createElement(c.default,{appearance:n,label:o,svg:u({appearance:n,iconGradientStart:g,iconGradientStop:y,iconColor:m}),iconColor:m,iconGradientStart:g,iconGradientStop:y,size:s,testId:d,textColor:v})}})),a("dYHhS",(function(t,a){e(t.exports,"useCompassDetails",(function(){return l}));var o=n("9nHZC"),r=n("7hcP7"),i=n("iKOGB");const l=()=>{const[e,t]=(0,o.useState)(),[n,a]=(0,o.useState)(!1),[l,s]=(0,o.useState)(),[c]=(0,r.usePathParam)("repositoryOwner"),[u]=(0,r.usePathParam)("repositorySlug"),[d="master"]=(0,r.usePathParam)("refOrHash"),p=`${c}/${u}`;return(0,o.useEffect)((()=>{(async()=>{a(!0);try{const e=await(0,i.getComponentFromYaml)(p,d);if(e)return t(e),void a(!1)}catch(e){}try{const e=await(0,i.getComponentFromRepositoryLink)(p);if(e.component)return t(e.component),void a(!1);if(!e.cloudUrl)return void a(!1);a(!1),s(`${e.cloudUrl}/compass/components/services?showCreateComponentModal=true`)}catch(e){a(!1)}})()}),[]),{isLoading:n,component:e,createLink:l}}})),a("iKOGB",(function(t,a){e(t.exports,"getComponentFromYaml",(function(){return l})),e(t.exports,"getComponentFromRepositoryLink",(function(){return s}));var o=n("635SY"),r=n("k2cPS");const i=async(e,t)=>{let n;try{const a=await fetch(new Request("https://bitbucket.org/gateway/api/graphql",{method:"POST",headers:{...r.jsonHeaders,"X-ExperimentalApi":"compass-beta, compass-prototype"},body:JSON.stringify({query:"\n  query compass_components_searchComponents($cloudId: ID!, $componentAri: ID!) {\n    tenantContexts(cloudIds: [$cloudId]) {\n      hostName\n      cloudId\n      cloudUrl\n    }\n    compass {\n      component(id: $componentAri) {\n        ... on CompassComponent {\n          id\n          name\n          description\n          ownerId\n\n          metricSources {\n            ...on CompassComponentMetricSourcesConnection {\n              nodes {\n                metricDefinition {\n                  id\n                  name\n                  format{\n                    ... on CompassMetricDefinitionFormatSuffix {\n                      suffix\n                    }\n                  }}\n                  values {\n                    ... on CompassMetricSourceValuesConnection {\n                      nodes {\n                        value\n                      }\n                    }\n                  }\n              }\n            }\n          }\n\n          links {\n            id\n            name\n            url\n            type\n          }\n        }\n      }\n    }\n  }\n",operationName:"compass_components_searchComponents",variables:{cloudId:e,componentAri:t}}),credentials:"include"}));n=await a.json()}catch(e){return{}}const{data:{tenantContexts:[{cloudUrl:a}],compass:{component:{id:o,name:i,ownerId:l,links:s,metricSources:c}}}}=n,u=/ari:cloud:compass.*component\/.+\/(.+)/.exec(o);if(!u)return{cloudUrl:a};const d=c.nodes.map((e=>{const{metricDefinition:{id:t,name:n,format:{suffix:a}},values:{nodes:o}}=e;return{id:t,name:n,value:o.length?`${o[0].value} ${a}`:null}})),[,p]=u;return{component:{url:`${a}/compass/component/${p}`,name:i,ownerId:l,metrics:d,links:s},cloudUrl:a}},l=async(e,t)=>{const n=o.default.api.v20.source(e,t,"compass.yml");let a=null;try{const e=await fetch((0,r.default)(n),{headers:r.jsonHeaders});a=await e.text()}catch(e){return null}if(!a)return null;const l=/id:\s+"(ari:cloud:compass:(.+):component\/.+\/(.+))"/.exec(a);if(!l)return null;const[,s,c]=l;try{const e=await i(c,s);if(!e)return null;const{component:t,cloudUrl:n}=e;if(!t)return null;if(!n)return t;try{const e=await(async(e,t)=>{const n=/ari:cloud:teams::team\/(.+)/.exec(e);if(!n)return null;const[,a]=n;let o;try{const e=await fetch(new Request(`https://bitbucket.org/gateway/api/v3/teams/${a}`,{credentials:"include"}));o=await e.json()}catch(e){return null}return{name:o.displayName,url:`${t}/compass/people/team/${a}`}})(t.ownerId,n);return e?{...t,team:e}:t}catch(e){return t}}catch(e){return null}},s=async e=>{let t;try{if(t=await(async e=>{try{const t=(0,r.default)(`/!api/internal/repositories/${e}/jira/sites`),n=await fetch(t);return(await n.json()).values[0]}catch(e){return null}})(e),!t)return{}}catch(e){return{}}try{const{component:n}=await(async(e,t)=>{let n=null;try{const a=await fetch(new Request("https://bitbucket.org/gateway/api/graphql",{method:"POST",headers:{...r.jsonHeaders,"X-ExperimentalApi":"compass-beta, compass-prototype"},body:JSON.stringify({query:"\n  query compass_components_searchComponents($cloudId: String!, $query: CompassSearchComponentQuery) {\n    compass {\n      searchComponents(cloudId: $cloudId, query: $query) {\n        ... on CompassSearchComponentConnection {\n          nodes {\n            link\n            component {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n",variables:{cloudId:e,query:{fieldFilters:[{name:"links",filter:{eq:`https://bitbucket.org/${t}`}}]}},operationName:"compass_components_searchComponents"}),credentials:"include"}));n=await a.json()}catch(e){return{}}const a=n.data.compass.searchComponents.nodes;let o;if(a.length&&(o=a[0].component.id),!o)return{};try{const{component:t}=await i(e,o);if(t)return{component:t}}catch(e){return{}}return{}})(t.cloudId,e);return n?{component:n}:{cloudUrl:t.cloudUrl}}catch(e){return{}}}}))}();
//# sourceMappingURL=source-diff.0dabcd54.js.map
